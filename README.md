# DarkAccess - Plataforma de Estudos Gameficada

![Status do Projeto](https://img.shields.io/badge/status-Em%20Produ%C3%A7%C3%A3o-green)
![Linguagem Principal](https://img.shields.io/badge/language-JavaScript-yellow)
![Licen√ßa](https://img.shields.io/badge/license-MIT-green)
![Hospedagem](https://img.shields.io/badge/hosted-GCP-blue)


## Acesso ao Projeto

**Aplica√ß√£o:** [http://34.132.60.57](http://34.132.60.57)  
**Hospedagem:** Google Cloud Platform (GCP) - Ubuntu Server

---
## Contexto 

Com o avan√ßo acelerado das tecnologias digitais e a presen√ßa constante da internet na rotina das pessoas, a seguran√ßa digital tornou-se uma √°rea de extrema relev√¢ncia. Entretanto, apesar do crescente interesse pelo tema, o primeiro contato com conte√∫dos de ciberseguran√ßa frequentemente revela uma problem√°tica recorrente: para aqueles que j√° possuem algum conhecimento pr√©vio, a abordagem excessivamente te√≥rica tende a ser pouco estimulante; por outro lado, para iniciantes que ainda n√£o dominam conceitos fundamentais de tecnologia, os materiais dispon√≠veis costumam ser excessivamente complexos, t√©cnicos ou pouco did√°ticos.

Somado a isso, grande parte das metodologias de ensino ainda adota modelos r√≠gidos, dificultando o engajamento e a compreens√£o pr√°tica do conte√∫do. Observa-se tamb√©m que muitas solu√ß√µes educacionais gamificadas sobre seguran√ßa digital s√£o voltadas principalmente para crian√ßas ou para p√∫blicos j√° t√©cnicos, deixando uma lacuna significativa para estudantes iniciantes do ensino superior na √°rea de tecnologia.

√â nesse contexto que surge o DarkAccess, uma proposta inovadora de aprendizagem pr√°tica e interativa. O projeto busca preencher essa lacuna ao oferecer uma abordagem introdut√≥ria, acess√≠vel e envolvente, adequada ao n√≠vel de conhecimento de novos universit√°rios. Por meio de mec√¢nicas gamificadas e cen√°rios aplicados, o DarkAccess promove um primeiro contato mais motivador, din√¢mico e eficiente com conceitos essenciais da seguran√ßa digital.

---

## DarkAccess - A Plataforma de Gamefica√ß√£o sobre Cyberseguran√ßa

Uma plataforma web desenvolvida com React.js no Front-End e Node.js + Express no Back-End. A aplica√ß√£o apresenta uma narrativa interativa que acompanha o usu√°rio ao longo de sua jornada, introduzindo conceitos de ciberseguran√ßa de maneira contextualizada e envolvente.

Al√©m de transmitir conhecimento, o projeto busca estimular a criatividade na resolu√ß√£o de desafios e instigar a curiosidade do usu√°rio sobre o tema. A proposta √© que, ap√≥s vivenciar a experi√™ncia oferecida pelo DarkAccess, o usu√°rio sinta-se motivado a aprofundar seus estudos na √°rea de seguran√ßa digital, explorando novas possibilidades de aprendizado e desenvolvimento.

Os temas apresentados at√© o momento est√£o divididos entre narrador e dois laborat√≥rios pr√°ticos:

Narrador - Atrav√©s de suas falas apresenta temas como: 
- VPN
- Diferen√ßa entre Surface, DeepWeb e DarkWeb
- Phishing

Lab01 - laborat√≥rio pr√°tico que simula um site de uma empresa, mas que contem falhas de:
- XSS (Cross-Site Scripting)
- Arquivos expostos

Lab02 - Simula um acesso a um computador, demonstrando:
- Perigo de utilizar senhas padr√£o
- Quebra de autentica√ß√£o
- Vazamento de arquivos

Conex√£o com VPN - Apresenta o conceito de uma VPN e qual sua finalidade 


### **Contexto da Narrativa**

A Arpheus Tech √© uma empresa tradicional do setor tecnol√≥gico, com muitos anos de hist√≥ria e experi√™ncia. Iniciou sua trajet√≥ria como uma pequena desenvolvedora web, mas, ao longo do tempo, expandiu-se e consolidou-se no mercado gra√ßas √† qualidade de seus projetos e √† capacidade de adapta√ß√£o √†s mudan√ßas da era digital.

Com essa longa viv√™ncia no mundo da tecnologia, a Arpheus acompanhou de perto a evolu√ß√£o da internet ‚Äî e, junto dela, o crescimento constante dos crimes cibern√©ticos. Ao observar falhas comuns, como sistemas sem valida√ß√µes adequadas, arquivos sens√≠veis deixados expostos, rotas n√£o protegidas, uso de credenciais fracas e in√∫meros descuidos de desenvolvimento, a empresa percebeu a necessidade urgente de fortalecer a seguran√ßa digital.

Foi ent√£o que a Arpheus decidiu transformar-se: deixou de atuar apenas no desenvolvimento web e passou a concentrar seus esfor√ßos em seguran√ßa cibern√©tica. Dessa mudan√ßa nasceu a Aurora IA, uma intelig√™ncia artificial avan√ßada, criada para monitorar os sistemas internos da corpora√ß√£o e de seus clientes. Al√©m da prote√ß√£o ativa, a Aurora possui um modo de treinamento, focado em capacitar desenvolvedores e usu√°rios comuns a reconhecerem as amea√ßas e perigos espalhados pela internet.

Para intensificar o aprendizado de forma pr√°tica e instigante, a Arpheus liberou para a Aurora um conjunto de sistemas de teste ‚Äî ambientes preparados especialmente para que seus alunos possam explorar vulnerabilidades reais, por√©m controladas. O objetivo √© desafiar, despertar curiosidade e fortalecer a habilidade dos participantes em detectar riscos e se defender no universo digital.

---

### Casos de Uso - Pesquisa com Usu√°rios

Foi realizada uma pesquisa disponibilizando a aplica√ß√£o para um grupo de usu√°rios testarem livremente, explorando suas funcionalidades de acordo com a pr√≥pria experi√™ncia de uso.  
Os resultados foram extremamente positivos e geraram insights valiosos para orientar o pr√≥ximo ciclo de desenvolvimento, contribuindo diretamente para a evolu√ß√£o do produto.

### Relatos dos Usu√°rios
Os relatos completos podem ser encontrados em: [Relatos dos Usu√°rios](./Historias_de_Usuarios.md)

---

## Roadmap de Melhorias

Com base nos feedbacks coletados, foram definidas as seguintes melhorias para as pr√≥ximas vers√µes da aplica√ß√£o:

- [ ] **Implementar valida√ß√£o JWT** para refor√ßar a seguran√ßa  
- [ ] **Ajustar responsividade** e desenvolver **vers√£o mobile**  
- [ ] **Melhorar o fluxo de perguntas e respostas** entre usu√°rio e narrador  
- [ ] **Aprimorar a exibi√ß√£o do progresso** do usu√°rio  
- [ ] **Corrigir erros e inconsist√™ncias nas falas** do narrador  

---

##Diagrama de Caso de Uso

## <img width="2040" height="2120" alt="image" src="https://github.com/user-attachments/assets/f5214aeb-c95e-4967-9cc0-3492cbf8ef7a" />

---

## Arquitetura do Projeto

## Requisitos Funcionais

- RF01 - Sistema de Autentica√ß√£o e Autoriza√ß√£o (registro, login, criptografia bcrypt)
- RF02 - Sistema de Progress√£o por Etapas (controle de progress√£o narrativa sequencial)
- RF03 - Sistema de Narrador Interativo (falas com efeito typewriter, skip, repetir)
- RF04 - Sistema de Desafios e Valida√ß√£o de Respostas (valida√ß√£o, conquistas, perda de vida)
- RF05 - Sistema de Dicas (dicas contextualizadas, contador de uso)
- RF06 - Sistema de Conquistas (desbloqueio autom√°tico, exibi√ß√£o no perfil)
- RF07 - Gest√£o Din√¢mica de Laborat√≥rios Docker (criar/destruir containers isolados)
- RF08 - Sistema de Ranking (ordena√ß√£o por vida, conquistas, dicas)
- RF09 - Perfil de Usu√°rio (estat√≠sticas, conquistas, avatar)
- RF10 - Navega√ß√£o entre P√°ginas (login, home, labs, perfil)

## Requisitos N√£o Funcionais
- RNF01 - Performance (APIs < 500ms, containers < 10s, carregamento < 3s)
- RNF02 - Seguran√ßa (bcrypt, prepared statements, CORS, isolamento Docker)
- RNF03 - Escalabilidade (backend stateless, portas din√¢micas, SPA)
- RNF04 - Disponibilidade (GCP e2-medium, Docker Compose)
- RNF05 - Usabilidade (interface "terminal hacker", feedback visual, responsivo)
- RNF06 - Manutenibilidade (c√≥digo modular, documenta√ß√£o)
- RNF07 - Portabilidade (Docker, funciona em Linux/Windows)
- RNF08 - Confiabilidade (transa√ß√µes at√¥micas, valida√ß√µes, tratamento de erros)
- RNF09 - Compatibilidade com navegadores modernos

**Frontend:**
- React 19.1.1
- React Router DOM 7.9.3
- Axios 1.13.2
- React Icons 5.5.0
- CSS Modules

<img width="295" height="507" alt="image" src="https://github.com/user-attachments/assets/a958fe50-34d1-4e9d-8696-280e52075155" />

**Backend:**
- Node.js 18
- Express 5.1.0
- bcrypt 6.0.0
- pg 8.16.3 (PostgreSQL client)
- dockerode (Docker API client)

<img width="316" height="485" alt="image" src="https://github.com/user-attachments/assets/8db8a9be-1239-40b1-af60-770dac73531f" />

  
**Banco de Dados:**
- PostgreSQL 14

**Infraestrutura:**
- Docker 24+
- Docker Compose
- Traefik 3.0 (reverse proxy)
- GCP e2-medium (Ubuntu 22.04)

# VM - GCP
<img width="1920" height="969" alt="image" src="https://github.com/user-attachments/assets/074350d7-f9d0-41ed-a4e2-688db490ce30" />


## Diagrama de Arquitetura

<img width="2842" height="1001" alt="diagrama de arquitetura" src="https://github.com/user-attachments/assets/0480b6a9-ce9e-4c9a-bba6-826084bdbf03" />


| Cor | Componente | Descri√ß√£o |
|-----|------------|-----------|
| üü† Laranja | **Usu√°rio** | Estudante de ciberseguran√ßa que acessa a plataforma |
| üîµ Azul Claro | **Frontend** | Interface do usu√°rio (React 18 + Nginx) |
| üü¢ Verde-√Ågua | **Backend** | API REST (Node.js 18 + Express 4.21) |
| üü¢ Verde-Escuro | **Traefik** | Reverse Proxy e roteador de requisi√ß√µes |
| üü¢ Verde | **Docker/Labs** | Engine Docker e containers de laborat√≥rios |
| üü£ Roxo | **Database** | Banco de dados PostgreSQL 14 |
| üîµ Azul | **Cloud** | Infraestrutura Google Cloud Platform |

#### Detalhamento dos Componentes

1. **Usu√°rio** acessa `http://34.132.60.57` via navegador web
   - O IP p√∫blico da VM GCP est√° configurado sem DNS/dom√≠nio customizado
   - Tr√°fego HTTP na porta 80

2. **Traefik** (porta 80) recebe a requisi√ß√£o e realiza roteamento inteligente:
   - **Host: `34.132.60.57` ou `localhost`** ‚Üí Redireciona para **Frontend** (prioridade 1)
   - **Path: `/api/*`** ‚Üí Redireciona para **Backend** na porta 3001 (prioridade 2)
   - **Labs din√¢micos** ‚Üí Roteamento via labels Docker para containers de usu√°rios espec√≠ficos

3. **Frontend (React + Nginx)** :
   - Nginx retorna o `index.html` e assets est√°ticos do build React
   - Usu√°rio navega entre p√°ginas: `/login`, `/register`, `/start`, `/darkaccess`, `/deepweb`, `/user`
   - React Router gerencia navega√ß√£o client-side sem recarregar p√°gina

4. **Frontend** executa chamadas REST para o **Backend**:
   - `POST http://34.132.60.57:3001/api/auth/login` ‚Üí Autentica√ß√£o
   - `GET http://34.132.60.57:3001/api/narrador/:userId/mensagens` ‚Üí Narrativa
   - `POST http://34.132.60.57:3001/api/labs/start` ‚Üí Provisionar lab
   - `GET http://34.132.60.57:3001/api/conquistas/:userId` ‚Üí Conquistas
   - Respostas em formato JSON com dados estruturados

5. **Backend (Node.js + Express)** processa requisi√ß√µes:
   - Valida credenciais com bcrypt para autentica√ß√£o
   - Consulta **PostgreSQL** via prepared statements: `SELECT * FROM usuarios WHERE usuario = $1`
   - Retorna dados: `{success: true, userId, pontos, vidas, etapa_atual}`
   - Armazena estado do narrador: fase atual, mensagens exibidas

6. **Backend** gerencia labs via **Docker Engine**:
   - Monta `/var/run/docker.sock` para controlar containers
   - Cria container: `docker.createContainer({name: 'lab02-user-123', network: 'challenge-net'})`
   - Inicia lab: `container.start()` com porta aleat√≥ria mapeada (ex: 32768)
   - Traefik detecta automaticamente via labels e cria rota din√¢mica
   - Agenda remo√ß√£o: `setTimeout(() => container.stop().remove(), 30 * 60 * 1000)`

7. **Labs** s√£o acessados pelo usu√°rio:
   - Backend retorna URL: `http://34.132.60.57:32768` (porta mapeada)
   - Usu√°rio abre em nova aba e interage com ambiente isolado
   - Lab02-OSDB: Explora√ß√£o de SQL Injection em Node.js + SQLite
   - XSS-Challenge: Testes de Cross-Site Scripting em React + Vite

8. **PostgreSQL** persiste todos os dados:
   - Tabela `usuarios`: credenciais, progresso, pontos, vidas
   - Tabela `narrador_estado`: fase atual e mensagens j√° exibidas
   - Tabela `conquistas_usuario`: achievements desbloqueados
   - Volume `db_data` garante persist√™ncia mesmo ap√≥s restart dos containers

9. **Toda infraestrutura roda na GCP VM**:
   - IP p√∫blico: `34.132.60.57` (e2-medium, Ubuntu 22.04)
   - Rede `darkaccess-net`: Frontend, Backend, PostgreSQL, Traefik
   - Rede `challenge-net`: Labs isolados dos servi√ßos principais
   - Firewall GCP: Apenas portas 80/443 expostas publicamente


## Todos os Componentes do Sistema

### 1. Traefik (Reverse Proxy)

**Imagem:** `traefik:v3.0`

**Fun√ß√£o:**
- Ponto de entrada √∫nico para todo tr√°fego HTTP (porta 80)
- Roteamento inteligente baseado em labels dos containers
- Gerenciamento de acesso aos labs din√¢micos

**Portas:**
- `80:80` - HTTP (√öNICA porta exposta externamente)

**Volumes:**
```yaml
- /var/run/docker.sock:/var/run/docker.sock  # Descoberta autom√°tica de containers
- ./traefik/traefik.yml:/etc/traefik/traefik.yml  # Configura√ß√£o est√°tica
- ./traefik/dynamic.yml:/etc/traefik/dynamic.yml  # Configura√ß√£o din√¢mica
- ./traefik/acme.json:/acme.json  # Certificados SSL (futuro)
```

**Redes:**
- `darkaccess-net` - Rede principal da aplica√ß√£o
- `challenge-net` - Rede isolada dos labs

**Configura√ß√£o (`traefik.yml`):**
```yaml
api:
  dashboard: true  # Dashboard em localhost:8080

entryPoints:
  web:
    address: ":80"

providers:
  docker:
    exposedByDefault: false  # Apenas containers com traefik.enable=true
  file:
    filename: /etc/traefik/dynamic.yml
    watch: true
```

**Middleware (`dynamic.yml`):**
```yaml
http:
  middlewares:
    strip-challenge:
      stripPrefixRegex:
        regex:
          - "/challenge/[A-Za-z0-9-]+"  # Remove prefixo de labs
```

---

### 2. Frontend (React SPA)

**Build:** Multi-stage Dockerfile

**Stage 1 - Build:**
```dockerfile
FROM node:18-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci --silent
COPY . .
RUN npm run build
```

**Stage 2 - Serve:**
```dockerfile
FROM nginx:stable-alpine
COPY --from=build /app/build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**Labels Traefik:**
```yaml
labels:
  - "traefik.enable=true"
  - "traefik.http.routers.frontend.rule=Host(`34.132.60.57`) || Host(`localhost`)"
  - "traefik.http.routers.frontend.entrypoints=web"
  - "traefik.http.services.frontend.loadbalancer.server.port=80"
  - "traefik.http.routers.frontend.priority=1"
```

**Caracter√≠sticas:**
- Single Page Application (SPA) React 19.1.1
- Servido via Nginx (leve e eficiente)
- Roteamento via React Router 7.9.3
- Build otimizado (minifica√ß√£o, tree shaking)

---

### 3. Backend (Node.js + Express)

**Imagem Base:** `node:18-slim`

**Dockerfile:**
```dockerfile
FROM node:18-slim
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3001
CMD ["npm", "start"]
```

**Portas:**
- `3001:3001` - Exposi√ß√£o direta (SEM Traefik)

**Volumes Cr√≠ticos:**
```yaml
volumes:
  - /var/run/docker.sock:/var/run/docker.sock  # API Docker para criar containers
  - /usr/bin/docker:/usr/bin/docker            # Bin√°rio Docker CLI
  - ./DarkAccess/Back-End:/app                 # Hot reload (dev)
```

**Vari√°veis de Ambiente:**
```bash
# Banco de Dados
DB_HOST=db_darkaccess
DB_USER=darkaccess_user
DB_PASS=senhasegura123
DB_NAME=darkaccess
DB_PORT=5432

# API
API_HOST=0.0.0.0
API_PORT=3001
NODE_ENV=production

# Deploy
DOMAIN=34.132.60.57    # IP p√∫blico da VM GCP
USE_TRAEFIK=true       # Habilita modo Traefik para labs
```

**Capacidades Especiais:**
- **Cria√ß√£o de Containers:** Acesso root ao Docker host via socket
- **Gest√£o de Labs:** Cria/destr√≥i containers sob demanda
- **M√©tricas:** Exporta m√©tricas Prometheus em `/metrics`

**Depend√™ncias:**
- `express@5.1.0` - Framework web
- `pg@8.16.3` - Cliente PostgreSQL
- `bcrypt@6.0.0` - Hash de senhas
- `dockerode` - Cliente Docker API
- `prom-client` - M√©tricas Prometheus

---

### 4. PostgreSQL (Banco de Dados)

**Imagem Custom:** `costaluan/db_darkaccess`

**Conte√∫do da Imagem:**
- PostgreSQL 14
- Schema inicial (tabelas, √≠ndices)
- Dados iniciais:
  - Conquistas dispon√≠veis
  - Falas do narrador
  - Dicas por etapa

**Volume Persistente:**
```yaml
volumes:
  - db_data:/var/lib/postgresql/data  # Dados sobrevivem a restarts
```

**Portas:**
- `5432:5432` - Exposi√ß√£o interna na rede `darkaccess-net`

**Vari√°veis:**
```bash
POSTGRES_USER=darkaccess_user
POSTGRES_PASSWORD=senhasegura123
POSTGRES_DB=darkaccess
```

**Tabelas Principais:**
- `usuarios` - Dados de autentica√ß√£o e progress√£o
- `conquistas` - Badges desbloque√°veis
- `conquistas_usuario` - Relacionamento N:N
- `falas_narrador` - Narrativa do jogo
- `dicas_narrador` - Dicas contextualizadas
- `labs_ativos` - Registro de containers criados

---

### 5. Labs Din√¢micos (Containers Sob Demanda)

**Diferencial:** N√£o est√£o no `docker-compose.yml` - s√£o criados pelo backend via Docker API.

#### Lab01 - XSS Challenge

**Imagem:** `costaluan/lab01-atualizado:latest`

**Aplica√ß√£o:** Tech Horizon (blog de tecnologia vulner√°vel)

**Vulnerabilidades:**
- XSS Reflected e Stored
- Arquivos sens√≠veis expostos (`/files/leaked-config.json`)
- CORS permissivo

**Porta Interna:** 5173 (Vite dev server)

**Nomea√ß√£o:** `user{usuario_id}-lab01-{timestamp}`

#### Lab02 - OS Command Injection Database (OSDB)

**Imagem:** `costaluan/lab02-osdb:latest`

**Aplica√ß√£o:** Sistema de busca de arquivos com vulnerabilidade

**Vulnerabilidades:**
- SQL Injection
- Command Injection via input de busca
- Senhas padr√£o em arquivos
- Path traversal

**Porta Interna:** 3000 (Node.js + Express)

**Nomea√ß√£o:** `user{usuario_id}-lab02-{timestamp}`

#### Configura√ß√£o de Container Din√¢mico

```javascript
// Backend: routes/docker.js
const container = await docker.createContainer({
  Image: `costaluan/${lab_id}-atualizado:latest`,
  name: containerName,
  ExposedPorts: { [`${labConfig.porta}/tcp`]: {} },
  HostConfig: {
    PortBindings: { [`${labConfig.porta}/tcp`]: [{ HostPort: `${port}` }] },
    NetworkMode: 'challenge-net',
    AutoRemove: false,
    RestartPolicy: { Name: 'no' }
  },
  Labels: {
    'traefik.enable': 'true',
    'managed-by': 'darkaccess-backend',
    'user-id': usuario_id,
    'lab-id': lab_id,
    'created-at': new Date().toISOString()
  }
});
```

**Lifecycle:**
1. **Cria√ß√£o:** POST `/api/docker/start-lab`
2. **Registro:** Salvo em `activeContainers` (Map) + `labs_ativos` (DB)
3. **Uso:** Usu√°rio acessa via `http://34.132.60.57:{porta}`
4. **Auto-destrui√ß√£o:** Ap√≥s 30 minutos de inatividade
5. **Remo√ß√£o Manual:** POST `/api/docker/stop-lab`

---

## Redes Docker

### darkaccess-net (Rede Principal)

**Driver:** `bridge`

**Containers:**
- `traefik`
- `darkaccess-frontend`
- `darkaccess-backend`
- `db_darkaccess`

**Finalidade:** Comunica√ß√£o entre componentes principais da aplica√ß√£o.

### challenge-net (Rede de Labs)

**Driver:** `bridge`

**Containers:**
- `traefik` (conectado a ambas as redes)
- Labs din√¢micos (`user*-lab*`)

**Finalidade:** Isolamento dos labs vulner√°veis.

**Seguran√ßa:**
- Labs n√£o acessam `darkaccess-net`
- Labs n√£o acessam banco de dados diretamente
- Labs n√£o acessam backend diretamente

---

#### Camadas de Seguran√ßa

- **Traefik**: SSL/TLS termination, firewall de aplica√ß√£o
- **Backend**: Bcrypt (10 rounds), prepared statements SQL
- **Docker**: Isolamento de containers, networks separadas (darkaccess-net, challenge-net)
- **GCP**: Firewall rules (apenas portas 80/443 expostas)

#### Fluxo de Dados

1. **Usu√°rio** acessa via navegador (HTTP/HTTPS)
2. **Traefik** recebe e roteia baseado em host/path
3. **Frontend** serve a interface React
4. **Frontend** faz chamadas REST para o **Backend**
5. **Backend** consulta o **PostgreSQL** para dados persistidos
6. **Backend** cria/gerencia labs via **Docker Engine**
7. **Labs** s√£o acessados dinamicamente pelo usu√°rio
8. Toda infraestrutura roda na **GCP VM**

---
## Diagrama do Banco de Dados

<img width="2763" height="1903" alt="Diagrama BD" src="https://github.com/user-attachments/assets/c94c170d-6133-40ed-9450-5a14893addc2" />

---

# Actions

Existem duas Actions principais que executam a cada novo commit realizado na branch main:
- Build: Para executar o SonarQube

<img width="514" height="420" alt="image" src="https://github.com/user-attachments/assets/49a25612-24a8-4294-8bfe-a69df4d54e82" />


- GCP-Deploy: Para executar uma atualiza√ß√£o direta no respit√≥rio de produ√ßao na VM

<img width="553" height="487" alt="image" src="https://github.com/user-attachments/assets/589b2c0d-d93f-4e18-acc1-b451243aff32" />

  
<img width="2938" height="1642" alt="image" src="https://github.com/user-attachments/assets/d52d1c1d-ed87-4d89-9a25-447a7163a8e0" />

---

## Observabilidade - Grafana

<img width="1919" height="962" alt="image" src="https://github.com/user-attachments/assets/85a0c53e-03a6-4ea4-a453-a16420aa7f26" />

Principais m√©tricas monitoradas:
- HTTP Request total
- Usu√°rios Ativos
- Processos CPU

---
## Qualidade de Software - SonarQube

<img width="2938" height="1658" alt="image" src="https://github.com/user-attachments/assets/7b1fab91-801c-4ba8-8d1e-b385e68992b5" />

---
## Teste Unit√°rios

O projeto DarkAccess implementa testes automatizados tanto no frontend quanto no backend para garantir a qualidade e confiabilidade do c√≥digo. Os testes foram desenvolvidos utilizando **Jest** como framework principal, com bibliotecas complementares espec√≠ficas para cada contexto.

## Teste Front-End

### Tecnologias Utilizadas
- **Jest**: Framework de testes
- **@testing-library/react**: Testes de componentes React
- **@testing-library/jest-dom**: Matchers customizados
- **MemoryRouter**: Mock de react-router-dom

### Cobertura Alcan√ßada: 28.53%

<img width="928" height="519" alt="image" src="https://github.com/user-attachments/assets/0fc16c56-e1bd-4851-878c-0e289db5eb43" />

### Estrutura de Testes

#### Testes de Componentes (`src/`)

**1. Narrator.test.js (5 testes)**
- Renderiza√ß√£o do componente
- Efeito de digita√ß√£o
- Busca de fala via API
- Trigger de repeti√ß√£o
- Tratamento de erros

```javascript
it('deve renderizar o componente Narrator', () => {
  const { container } = render(<Narrator messages={[]} />);
  expect(container.querySelector('.box')).toBeInTheDocument();
});
```

**2. User.test.js (6 testes)**
- Renderiza√ß√£o do wrapper
- Aplica√ß√£o de estilo de vida
- Renderiza√ß√£o de avatar SVG
- Handler de onClick
- Valores diferentes de life

**3. HomePage.test.js (10 testes)**
- Renderiza√ß√£o da p√°gina
- Bot√µes de labs
- In√≠cio de desafios
- Sistema de dicas
- Atualiza√ß√£o de input
- Integra√ß√£o com Narrator e User

**4. Login.test.js (7 testes)**
- Renderiza√ß√£o do formul√°rio
- Atualiza√ß√£o de campos
- Fluxo de login bem-sucedido
- Tratamento de erros
- Navega√ß√£o para registro

**5. Register.test.js (4 testes)**
- Renderiza√ß√£o do formul√°rio
- Atualiza√ß√£o de campos
- Fluxo de registro
- Link para login

**6. progressao.test.js (1 teste)**
- C√°lculo de progress√£o

### Configura√ß√£o do Jest (Frontend)

**package.json:**
```json
{
  "jest": {
    "transformIgnorePatterns": [
      "node_modules/(?!(react-router|react-router-dom)/)"
    ]
  }
}
```

**jest.config.js:**
```javascript
module.exports = {
  transformIgnorePatterns: [
    'node_modules/(?!(react-router|react-router-dom|@remix-run)/)'
  ],
  moduleNameMapper: {
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy'
  }
};
```

### Setup Global (Frontend)

**setupTests.js:**
```javascript
// Mocks globais
global.fetch = jest.fn();
Storage.prototype.getItem = jest.fn();
Storage.prototype.setItem = jest.fn();
window.matchMedia = jest.fn().mockImplementation(query => ({
  matches: false,
  media: query,
  addListener: jest.fn(),
  removeListener: jest.fn(),
}));
```

### Mock Manual do React Router

**src/__mocks__/react-router-dom.js:**
```javascript
const MemoryRouter = ({ children }) => <div>{children}</div>;
const useNavigate = () => jest.fn();
const Link = ({ children, to, ...props }) => <a href={to} {...props}>{children}</a>;

module.exports = {
  MemoryRouter,
  BrowserRouter: MemoryRouter,
  useNavigate,
  Link,
  NavLink,
  useLocation,
  useParams,
};
```

### Estrat√©gia de Mocking (Frontend)

1. **API Fetch**: Mock global em setupTests.js
```javascript
global.fetch.mockResolvedValueOnce({
  ok: true,
  json: async () => mockData
});
```

2. **LocalStorage**: Mock de Storage prototype
```javascript
Storage.prototype.setItem = jest.fn();
Storage.prototype.getItem = jest.fn(() => 'mockValue');
```

3. **React Router**: Mock manual para evitar problemas com v7
```javascript
import { MemoryRouter } from 'react-router-dom';
render(<MemoryRouter><Component /></MemoryRouter>);
```

4. **Componentes**: Mock de componentes filhos
```javascript
jest.mock('../components/Narrator', () => ({
  __esModule: true,
  default: () => <div>Narrator Mock</div>
}));
```


### Como Executar os Testes

```bash
# Entrar no diret√≥rio do frontend
cd DarkAccess/Front-End

# Executar todos os testes
npm test

# Executar com cobertura
npm test -- --coverage --watchAll=false

# Executar teste espec√≠fico
npm test -- Narrator.test.js

# Executar em modo interativo
npm test
```

### Estrutura de Arquivos de Teste
```
Front-End/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Narrator/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Narrator.test.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ User.test.js
‚îÇ   ‚îú‚îÄ‚îÄ Pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HomePage.test.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Login.test.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Register/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Register.test.js
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ progressao.test.js
‚îÇ   ‚îú‚îÄ‚îÄ __mocks__/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ react-router-dom.js
‚îÇ   ‚îî‚îÄ‚îÄ setupTests.js          # Setup global
‚îú‚îÄ‚îÄ jest.config.js
‚îî‚îÄ‚îÄ package.json
```


# Back-End

### Tecnologias Utilizadas
- **Jest**: Framework de testes
- **Supertest**: Testes de endpoints HTTP
- **Mocks**: Simula√ß√£o de banco de dados e processos externos

### Cobertura Alcan√ßada: 76.12%

<img width="2232" height="490" alt="image" src="https://github.com/user-attachments/assets/31891633-d420-42ac-99be-c7d9fe267440" />

### Estrutura de Testes

#### Testes Unit√°rios (`tests/unit/`)

**1. auth.test.js (18 testes)**
- Registro de novos usu√°rios
- Login com email e username
- Valida√ß√£o de credenciais
- Busca de dados do usu√°rio com conquistas
- Sistema de ranking
- Tratamento de erros (400, 401, 404, 500)

```javascript
describe('POST /api/auth/register', () => {
  it('deve registrar um novo usu√°rio com sucesso', async () => {
    // Mock do banco de dados
    db.query.mockResolvedValueOnce({ rows: [mockUser] });
    
    const response = await request(app)
      .post('/api/auth/register')
      .send({ username, email, password });
    
    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
  });
});
```

**2. narrador.test.js (22 testes)**
- Busca de falas por etapa
- Valida√ß√£o de tela permitida
- Concatena√ß√£o de m√∫ltiplas falas
- Sistema de respostas corretas/incorretas
- Penaliza√ß√£o de vida por erros
- Desbloqueio de conquistas
- Sistema de dicas
- Atualiza√ß√£o de etapas

**3. conquistas.test.js (4 testes)**
- Listagem de conquistas do usu√°rio
- Tratamento de usu√°rios sem conquistas
- Valida√ß√£o de erros de banco

**4. labs.test.js (10 testes)**
- Inicializa√ß√£o de labs (XSS e SO)
- Valida√ß√£o de challengeId
- Uso de vari√°veis de ambiente
- Parada de labs

**5. deepweb.test.js (7 testes)**
- Valida√ß√£o de credenciais (username, password, IP)
- Libera√ß√£o de acesso √†s profundezas
- Tratamento de campos faltantes
- Erros de autentica√ß√£o

**6. docker.test.js (17 testes)**
- Valida√ß√£o de par√¢metros
- Reconhecimento de labs (lab01, lab02)
- Verifica√ß√£o de containers existentes
- Listagem de labs ativos
- Parada de containers
- Uso de vari√°veis de ambiente (DOMAIN, USE_TRAEFIK)

#### Testes de Integra√ß√£o (`tests/integration/`)

**fluxo-completo.test.js (10 testes, 5 ativos)**
- Fluxo de registro e login
- Fluxo de jogo completo (login ‚Üí fala ‚Üí etapa ‚Üí conquistas)
- Fluxo de labs e respostas
- Sistema de ranking
- Sistema de dicas
- Desbloqueio de conquista de primeiro acesso

### Configura√ß√£o do Jest (Backend)

**jest.config.js:**
```javascript
module.exports = {
  testEnvironment: 'node',
  coverageDirectory: 'coverage',
  collectCoverageFrom: [
    'routes/**/*.js',
    '!routes/**/index.js',
    '!**/node_modules/**',
    '!**/tests/**'
  ],
  coverageThreshold: {
    global: {
      branches: 75,
      functions: 67,
      lines: 76,
      statements: 76
    }
  }
};
```

### Estrat√©gia de Mocking (Backend)

1. **Banco de Dados**: Mock completo do m√≥dulo `db.js`
```javascript
jest.mock('../../db');
db.query.mockResolvedValueOnce({ rows: [...] });
```

2. **Child Process**: Mock de `spawn` para testes de Docker
```javascript
jest.mock('child_process');
spawn.mockReturnValue(mockSpawn);
```

3. **Vari√°veis de Ambiente**: Configura√ß√£o espec√≠fica por teste
```javascript
process.env.VPN_USER = 'testuser';
process.env.DOMAIN = 'localhost';
```

## Como Executar os Testes

```bash
# Entrar no diret√≥rio do backend
cd DarkAccess/Back-End

# Executar todos os testes
npm test

# Executar com cobertura
npm run test:coverage

# Executar apenas testes unit√°rios
npm run test:unit

# Executar apenas testes de integra√ß√£o
npm run test:integration

# Executar em modo watch
npm run test:watch
```

## Estrutura de Arquivos de Testes

```
Back-End/
‚îú‚îÄ‚îÄ routes/                    # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îú‚îÄ‚îÄ narrador.js
‚îÇ   ‚îú‚îÄ‚îÄ conquistas.js
‚îÇ   ‚îú‚îÄ‚îÄ labs.js
‚îÇ   ‚îú‚îÄ‚îÄ deepweb.js
‚îÇ   ‚îî‚îÄ‚îÄ docker.js
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/                  # Testes unit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.test.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ narrador.test.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conquistas.test.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ labs.test.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deepweb.test.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docker.test.js
‚îÇ   ‚îî‚îÄ‚îÄ integration/           # Testes de integra√ß√£o
‚îÇ       ‚îî‚îÄ‚îÄ fluxo-completo.test.js
‚îú‚îÄ‚îÄ jest.config.js             # Configura√ß√£o do Jest
‚îú‚îÄ‚îÄ jest.setup.js              # Setup global
‚îî‚îÄ‚îÄ package.json
```



## Processo de Deploy

### Ambiente de Produ√ß√£o

**Infraestrutura:**
- **Cloud:** Google Cloud Platform (GCP)
- **Regi√£o:** us-central1
- **VM:** e2-medium (2 vCPUs, 4 GB RAM)
- **OS:** Ubuntu 22.04 LTS
- **IP P√∫blico:** 34.132.60.57 (fixo)
- **Firewall:** Porta 80 aberta, 3001 aberta

### Pr√©-requisitos

```bash
# Instalados na VM
- Docker 24+
- Docker Compose 2.x
- Git
- Node.js 18 (apenas para desenvolvimento local)
```

### Comandos de Deploy

#### 1. Clone do Reposit√≥rio

```bash
ssh usuario@34.132.60.57
cd /opt
git clone https://github.com/luanjc77/Portifolio-de-Projeto.git
cd Portifolio-de-Projeto
```

#### 2. Configurar Vari√°veis de Ambiente

```bash
# Criar arquivo .env na raiz
cat > .env << EOF
# PostgreSQL
POSTGRES_USER=darkaccess_user
POSTGRES_PASSWORD=senhasegura123
POSTGRES_DB=darkaccess

# Backend
DB_HOST=db_darkaccess
DB_USER=darkaccess_user
DB_PASS=senhasegura123
DB_NAME=darkaccess
DB_PORT=5432

API_HOST=0.0.0.0
API_PORT=3001
NODE_ENV=production

# Deploy
DOMAIN=34.132.60.57
USE_TRAEFIK=true
EOF
```

#### 3. Build e Iniciar Containers

```bash
# Build das imagens (primeira vez ou ap√≥s mudan√ßas)
docker-compose build --no-cache

# Subir todos os servi√ßos
docker-compose up -d

# Verificar status
docker-compose ps
```

**Sa√≠da Esperada:**
```
NAME                   STATUS              PORTS
darkaccess-backend     Up 10 seconds       0.0.0.0:3001->3001/tcp
darkaccess-frontend    Up 10 seconds       80/tcp
db_darkaccess          Up 10 seconds       0.0.0.0:5432->5432/tcp
traefik                Up 10 seconds       0.0.0.0:80->80/tcp
```

#### 4. Verificar Logs

```bash
# Logs de todos os containers
docker-compose logs -f

# Logs de um container espec√≠fico
docker logs darkaccess-backend -f
docker logs traefik -f
```

### Atualiza√ß√£o de C√≥digo

#### Atualizar Backend/Frontend

```bash
# Na VM de produ√ß√£o
cd /opt/Portifolio-de-Projeto
docker compose -d --build
```

## Conclus√£o

O **DarkAccess** √© um sistema educacional completo que combina gamifica√ß√£o, narrativa interativa e ambientes pr√°ticos isolados para ensinar ciberseguran√ßa de forma envolvente. A arquitetura baseada em microservi√ßos Docker, banco de dados relacional e frontend moderno garante escalabilidade, seguran√ßa e manutenibilidade.

Os requisitos funcionais cobrem toda a jornada do usu√°rio desde registro at√© conclus√£o dos labs, enquanto os requisitos n√£o funcionais garantem performance, seguran√ßa e observabilidade adequadas para um ambiente de produ√ß√£o.

